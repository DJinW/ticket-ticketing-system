{"remainingRequest":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\src\\views\\ChangeTicket.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\src\\views\\ChangeTicket.vue","mtime":1617708212000},{"path":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1695374980619},{"path":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\node_modules\\babel-loader\\lib\\index.js","mtime":1695374980610},{"path":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1695374980619},{"path":"C:\\Users\\安姿铜\\Desktop\\TrainTicketSystem-master\\train-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1695374999645}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IERpYWxvZyB9IGZyb20gJ3ZhbnQnOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9yZGVyaWQ6MCwKICAgICAgIGRhdGU6ICcnLAogICAgICBzaG93OiBmYWxzZSwKICAgICAgLy8g5qCH5b+X5L2NCiAgICAgIHNob3dmbGFnOmZhbHNlLAogICAgICBzdGFydGNpdHk6J+adreW3nicsCiAgICAgIGVuZGNpdHk6J+WugeazoicsCiAgICAgIGNvdW50OiAwLAogICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgdHJhaW5kYXRlOicyMDIwLTUtMzAnLAogICAgICAgb3JkZXJsaXN0Olt7CiAgICAgICAgaWQ6JycsCiAgICAgICAgbmFtZTonRzEwMCcsCiAgICAgICAgc3RhcnRjaXR5Oifmna3lt54nLAogICAgICAgIHN0YXJ0dGltZTonMTYuMzcnLAogICAgICAgIGVuZGNpdHk6J+e7jeWFtCcsCiAgICAgICAgZW5kdGltZTonMTc6MzUnLAogICAgICAgIGR1cmF0aW9uOicyM+WIhumSnycsCiAgICAgICAgZm51bTonMzMnLAogICAgICAgIHNudW06JzQ0JywKICAgICAgICBmcHJpY2U6MzMsCiAgICAgICAgc3ByaWNlOjE5CiAgICAgIH1dLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKXsKICAgIAogICAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidHJhaW5kYXRlIikpewogICAgICAgICAgIHRoaXMuZGF0ZT1sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidHJhaW5kYXRlIik7CiAgICAgICAgICAgdGhpcy5zdGFydGNpdHk9c2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnc3RhcnRjaXR5Jyk7CiAgICAgICAgICAgdGhpcy5lbmRjaXR5PXNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2VuZGNpdHknKTsKICAgICAgICAgICB0aGlzLm9yZGVyaWQ9cGFyc2VJbnQoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnZGV0YWlsb3JkZXJpZCcpKTsKICAgICAgfQogICAgICB0aGlzLnRyYWlucXVlcnkoKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAgZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHJldHVybiBgJHtkYXRlLmdldEZ1bGxZZWFyKCl9LSR7ZGF0ZS5nZXRNb250aCgpICsgMX0tJHtkYXRlLmdldERhdGUoKX1gOwogICAgfSwKICAgIG9uQ29uZmlybShkYXRlKSB7CiAgICAgIHRoaXMuc2hvdyA9IGZhbHNlOwogICAgICB0aGlzLmRhdGUgPSB0aGlzLmZvcm1hdERhdGUoZGF0ZSk7CiAgICAgIHRoaXMudHJhaW5xdWVyeSgpOwogICAgfSwKCiAgICBvblJlZnJlc2goKSB7CiAgICAgIHRoaXMudHJhaW5xdWVyeSgpOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLiR0b2FzdCgn5Yi35paw5oiQ5YqfJyk7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLmNvdW50Kys7CiAgICAgIH0sIDEwMDApOwogICAgfSwKICAgIGJhY2soKXsKICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgIH0sCiAgCiAgICB0cmFpbnF1ZXJ5KCl7CiAgICAgIC8vIOaOpeWPo+afpeivogogICAgbGV0IHRoYXQgPSB0aGlzOwogICAgdGhpcy4kYXhpb3MoewogICAgICBtZXRob2Q6J2dldCcsCiAgICAgIHVybDonL3RyYWluL3RyYWludGlja2V0cXVlcnknLAogICAgICBwYXJhbXM6ewogICAgICAgICAgc3RhcnRjaXR5OnRoaXMuc3RhcnRjaXR5LAogICAgICAgICAgZW5kY2l0eTp0aGlzLmVuZGNpdHksCiAgICAgICAgICAvLyDml6XmnJ8KICAgICAgICAgIHRyYWluZGF0ZTogdGhpcy5kYXRlLAogICAgICAgICAgdHJhaW50eXBlOjIKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbihyZXMpewogICAgICAvLyBjb25zb2xlLmxvZyhyZXMpOwogICAgICBpZihyZXMuZGF0YS5jb2RlPT0yMDApewogICAgICAgIHRoYXQub3JkZXJsaXN0PXJlcy5kYXRhLmRhdGE7CiAgICAgICAgIHRoYXQuc2hvd2ZsYWc9dHJ1ZTsKICAgICAgfQogICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0pOwogICAgfSwKCiAgICAvLyDmlLnnrb4KICAgIGNoYW5nZVRpY2tldCh2YWwpewogICAgICBsZXQgdGhhdD10aGlzOwogICAgICBEaWFsb2cuY29uZmlybSh7CiAgICAgIHRpdGxlOiAn56Gu6K6k5o+Q56S6JywKICAgICAgbWVzc2FnZTogJ+aCqOaYr+WQpuehruiupOaUueetvuivpeWIl+i9picsCiAgfSkudGhlbigoKSA9PiB7CiAgICAgdGhpcy4kYXhpb3MoewogICAgICAgbWV0aG9kOidwb3N0JywKICAgICAgIHVybDonL29yZGVyL2NoYW5nZXRpY2tldCcsCiAgICAgICBkYXRhOnsKICAgICAgICAgdHJhaW5pZDp2YWwsCiAgICAgICAgIHRyYWluZGF0ZTp0aGlzLmRhdGUsCiAgICAgICAgIG9yZGVyaWQ6dGhpcy5vcmRlcmlkCiAgICAgICB9CiAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpewogICAgICAgIGlmKHJlcy5kYXRhLmNvZGU9PTUwMSl7CiAgICAgICAgICB0aGF0LiR0b2FzdC5mYWlsKCLor6Xnsbvnpajlt7LllK7nvYQiKQogICAgICAgIH1lbHNlIGlmKHJlcy5kYXRhLmNvZGU9PTIwMCl7CiAgICAgICAgICB0aGF0LiR0b2FzdC5zdWNjZXNzKCLmlLnnrb7miJDlip8iKTsKICAgICAgICAgIHRoYXQuJHJvdXRlci5wdXNoKCcvb3JkZXInKQogICAgICAgIH0KICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcikgewogICAgICAgY29uc29sZS5sb2coZXJyb3IpCiAgICAgfSkKICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgLy8gb24gY2FuY2VsCiAgICB9KTsKICAgICAgY29uc29sZS5sb2codmFsLHRoaXMuZGF0ZSx0aGlzLm9yZGVyaWQpCiAgICB9CiAgfSwKfQo="},{"version":3,"sources":["ChangeTicket.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChangeTicket.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"bac\" v-cloak v-if=\"showflag\">\n    <van-nav-bar\n      title=\"火车改签\">\n     <template #left>\n    <i class=\"el-icon-arrow-left\" @click=\"back\"></i>\n  </template>\n    </van-nav-bar>\n\n    <div class=\"traindate\">\n      <van-cell class=\"cell\" :value=\"date\" @click=\"show = true\" :center=\"true\"/>\n    </div>\n     <van-calendar v-model=\"show\" @confirm=\"onConfirm\" />\n\n    <van-pull-refresh v-model=\"isLoading\" @refresh=\"onRefresh\">\n    <!-- 判断是否为空 -->\n    <div v-if=\"orderlist.length!=0\">\n         <div  class=\"text item\" v-for=\"(item,index) in orderlist\" :key=\"index\" @click=\"changeTicket(item.id)\">\n          <el-card class=\"box-card\">\n              <van-row>\n                <van-col span=\"4\" class=\"otherinfo\">{{item.name}}</van-col>\n                <van-col span=\"7\" class=\"city\">{{item.startcity}}</van-col>\n                <van-col span=\"6\"><i class=\"trainicon\" /></van-col>\n                <van-col span=\"7\" class=\"city\">{{item.endcity}}</van-col>\n              </van-row>\n              <van-row >\n                <van-col span=\"7\" offset=\"4\" class=\"times\">{{item.starttime}}</van-col>\n                <van-col span=\"6\" id=\"traindate\">{{item.duration}}</van-col>\n                <van-col span=\"7\"  class=\"times\">{{item.endtime}}</van-col>\n              </van-row>\n              <van-divider dashed/>\n              <van-row class=\"ticket\">\n                 <van-col span=\"7\" >一等：{{item.fnum}} 张</van-col>\n                 <van-col span=\"7\" offset=\"9\">二等：{{item.snum}} 张</van-col>\n              </van-row>\n        </el-card>\n        \n\n      </div> \n      <div class=\"fill\"></div>\n      </div>\n      <!-- 没有火车信息 -->\n      <div v-else>\n          <van-empty description=\"试试乘坐其他班次吧\" />\n      </div>\n\n  </van-pull-refresh>\n   <div class=\"test\"></div>\n  </div>\n</template>\n\n<script>\nimport { Dialog } from 'vant';\nexport default {\n  data() {\n    return {\n      orderid:0,\n       date: '',\n      show: false,\n      // 标志位\n      showflag:false,\n      startcity:'杭州',\n      endcity:'宁波',\n      count: 0,\n      isLoading: false,\n       traindate:'2020-5-30',\n       orderlist:[{\n        id:'',\n        name:'G100',\n        startcity:'杭州',\n        starttime:'16.37',\n        endcity:'绍兴',\n        endtime:'17:35',\n        duration:'23分钟',\n        fnum:'33',\n        snum:'44',\n        fprice:33,\n        sprice:19\n      }],\n    };\n  },\n  created(){\n    \n      if(localStorage.getItem(\"traindate\")){\n           this.date=localStorage.getItem(\"traindate\");\n           this.startcity=sessionStorage.getItem('startcity');\n           this.endcity=sessionStorage.getItem('endcity');\n           this.orderid=parseInt(sessionStorage.getItem('detailorderid'));\n      }\n      this.trainquery();\n  },\n\n  methods: {\n     formatDate(date) {\n      return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n    },\n    onConfirm(date) {\n      this.show = false;\n      this.date = this.formatDate(date);\n      this.trainquery();\n    },\n\n    onRefresh() {\n      this.trainquery();\n      setTimeout(() => {\n        this.$toast('刷新成功');\n        this.isLoading = false;\n        this.count++;\n      }, 1000);\n    },\n    back(){\n      this.$router.go(-1);\n    },\n  \n    trainquery(){\n      // 接口查询\n    let that = this;\n    this.$axios({\n      method:'get',\n      url:'/train/trainticketquery',\n      params:{\n          startcity:this.startcity,\n          endcity:this.endcity,\n          // 日期\n          traindate: this.date,\n          traintype:2\n      }\n    }).then(function(res){\n      // console.log(res);\n      if(res.data.code==200){\n        that.orderlist=res.data.data;\n         that.showflag=true;\n      }\n    }).catch(function (error) {\n        console.log(error);\n        });\n    },\n\n    // 改签\n    changeTicket(val){\n      let that=this;\n      Dialog.confirm({\n      title: '确认提示',\n      message: '您是否确认改签该列车',\n  }).then(() => {\n     this.$axios({\n       method:'post',\n       url:'/order/changeticket',\n       data:{\n         trainid:val,\n         traindate:this.date,\n         orderid:this.orderid\n       }\n     }).then(function(res){\n        if(res.data.code==501){\n          that.$toast.fail(\"该类票已售罄\")\n        }else if(res.data.code==200){\n          that.$toast.success(\"改签成功\");\n          that.$router.push('/order')\n        }\n     }).catch(function(error) {\n       console.log(error)\n     })\n    }).catch(() => {\n      // on cancel\n    });\n      console.log(val,this.date,this.orderid)\n    }\n  },\n}\n</script>\n\n<style lang=\"less\" scoped>\n[v-cloak]{\n    display: none !important;\n}\n.bac{\n  // background-color:red;\n  position: relative;\n  // height: 200%;\n  width: 100%;\n}\n.van-nav-bar{\n  background-color: rgba(0, 170, 238, 1);\n  position: fixed;\n  width: 100%;\n}\n/deep/.van-nav-bar__title{\n  color: white;\n}\n/deep/.van-tab{\n  background-color:#f8f8f8;\n}\n.el-icon-arrow-left{\n margin-left: 0 !important;\n color: white;\n font-size: 22px;\n}\n/deep/.el-card__body{\n  padding:8px;\n}\n\n.traindate{\n  position: fixed;\n  top:45px;\n  height: 30px;\n  width: 100%;\n  background-color:  rgba(0, 170, 238, 1);\n  border: none;\n  color: whitesmoke;\n  z-index: 1;\n}\n\n.van-pull-refresh{\n  height: 100%;\n  padding-top: 75px;\n}\n.box-card{\n  background: #fbfbfb;\n  border-radius: 10px;\n  margin: 10px;\n}\n.fill{\n  height: 200px;\n}\n.trainicon{\n  background-color: red;\n  height: 20px;\n  width:65px;\n  display: inline-block;\n  background: url('../assets/order/arrive1.png') no-repeat;\n}\n.city{\n  font-size: 20px;\n  font-weight: bold;\n}\n.otherinfo{\n  font-size: 18px;\n  margin-top: 5px;\n}\n#traindate{\n  color: #aaa;\n  font-size: 14px;\n}\n.times{\n  color: rgba(0, 170, 238, 1);\n  font-size: 13px;\n}\n.ticket{\n  font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;\n  font-size: 13px;\n}\n\n.cell{\n  width: 40%;\n  margin:0 auto;\n  height: 28px;\n  // padding: 3px auto;\n  padding-left: 11%;\n}\n</style>"]}]}